"use strict";(self.webpackChunksc_tree=self.webpackChunksc_tree||[]).push([[7960],{67960:(e,t,s)=>{s.r(t),s.d(t,{SelfSnappingEngine:()=>N});var i=s(35143),r=s(91967),n=s(94643),o=s(46053),h=(s(81806),s(76460),s(47249),s(85842)),a=s(73582),d=s(24648),l=s(9392),c=s(12482),p=s(23862),g=s(31633),u=s(19555),f=s(63078),v=s(70330),x=s(17072);class L{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=f.N.shortLineThreshold*f.N.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,p.Lp)(e.leftVertex.pos,this.view,t),(0,p.Lp)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,s){let{spatialReference:i}=s;return 0===this.squaredShortLineThreshold||(0,v.pM)((0,x.j)(t,i,c.qt,this.view),(0,x.j)(e,i,c.qt,this.view))>this.squaredShortLineThreshold}isVertical(e,t,s){let{spatialReference:i}=s;const r=(0,g.GA)(i);return(0,u.Io)((0,p.Xz)(e),(0,p.Xz)(t))*r<f.N.verticalLineThresholdMeters}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,s=e*t;return s*s}}var E=s(45633),_=s(89646),w=s(79337),V=s(74050);class m extends L{constructor(e,t,s){super(e,t),this._geodesicLengthMeasurementUtils=s}snapNewVertex(e,t){const s=t.editGeometryOperations.data.components[0],i=s.edges.length,r=[];if(i<1)return r;const{spatialReference:n}=t,o=(0,x.j)(e,n,c.qt,this.view),{view:h}=this,a=s.edges[i-1];let d=a;do{if(this.edgeExceedsShortLineThreshold(d,t)){const s=(0,v.is)(d,h,t);this._processCandidateProposal(s.left,s.right,e,o,t,r)}d=d.leftVertex.leftEdge}while(d&&d!==a);return r}snapExistingVertex(e,t){const s=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return s;const{view:n}=this,{spatialReference:o}=t,h=(0,x.j)(e,o,c.qt,n),a=i.leftEdge,d=i.rightEdge;a&&d&&this.edgeExceedsShortLineThreshold(a,t)&&this.edgeExceedsShortLineThreshold(d,t)&&this._processCandidateProposal((0,p.Lp)(a.leftVertex.pos,n,t),(0,p.Lp)(d.rightVertex.pos,n,t),e,h,t,s);const l=r.edges[0];let g=l;do{if(g!==i.leftEdge&&g!==i.rightEdge&&this.edgeExceedsShortLineThreshold(g,t)){const i=(0,v.is)(g,n,t);this._processCandidateProposal(i.left,i.right,e,h,t,s)}g=g.rightVertex.rightEdge}while(g&&g!==l);return s}_processCandidateProposal(e,t,s,i,r,n){var o;const{spatialReference:h,pointer:g}=r,u=(0,l.vt)();!function(e,t,s,i,r,n){(function(e,t,s,i,r,n){let{spatialReference:o}=r;const h=(0,_.IP)(t,s,o,o);if(null==h)return!1;const l=(0,_.IP)(s,i,o,o);if(null==l)return!1;const c=n.geodesicDistance(s,i,o);if(null==c)return!1;const p=Math.abs(a.wf.shortestSignedDiff(h,l))>Math.PI/2?a.uC.normalize(h+Math.PI):h;return(0,_.rT)(e,s,o,(0,d.l3)(c,"meters"),(0,d.Wq)(p,"radians","geographic"),"geodesic"),e[2]=i[2],!0})(e,t,s,i,r,n)||function(e,t,s,i){(0,w.Yv)(t,{start:s,end:i,type:V.Vv.LINE},e),e[2]=t[2]}(e,i,t,s)}(u,e,t,s,r,this._geodesicLengthMeasurementUtils);const f=(0,p.de)((0,p._7)(u));(0,v.pM)(i,(0,x.j)(f,h,c.qt,this.view))<this.squaredProximityThreshold(g)&&n.push(new E.o({lineStart:e,lineEnd:t,targetPoint:f,isDraped:"on-the-ground"===(null===(o=r.elevationInfo)||void 0===o?void 0:o.mode)}))}}var P=s(72745),T=s(20612);class y extends L{snapNewVertex(e,t){const s=t.editGeometryOperations.data.components[0],i=s.edges.length,r=s.vertices.length,n=[];if(i<2)return n;const{view:o}=this,h=(0,x.j)(e,t.spatialReference,c.qt,o),a=(0,p.Lp)(s.vertices[r-1].pos,o,t),d=(0,p.Lp)(s.vertices[0].pos,o,t),l=s.edges[i-1];let g=l;do{if(this.edgeExceedsShortLineThreshold(g,t)){const s=(0,v.is)(g,o,t);this._checkEdgeForParallelLines(s,a,e,h,t,n),this._checkEdgeForParallelLines(s,d,e,h,t,n)}g=g.leftVertex.leftEdge}while(g&&g!==l);return n}snapExistingVertex(e,t){const s=[],i=t.vertexHandle,r=i.component;if(r.edges.length<3)return s;const{view:n}=this,o=(0,x.j)(e,t.spatialReference,c.qt,n),h=i.leftEdge,a=i.rightEdge,d=r.vertices[0],l=(0,p.Lp)(d.pos,n,t),g=r.vertices.length,u=r.vertices[g-1],f=(0,p.Lp)(u.pos,n,t),L=r.edges[0];let E=L;do{if(E!==h&&E!==a&&this.edgeExceedsShortLineThreshold(E,t)){const r=(0,v.is)(E,n,t);h&&this._checkEdgeForParallelLines(r,(0,p.Lp)(h.leftVertex.pos,n,t),e,o,t,s),a&&this._checkEdgeForParallelLines(r,(0,p.Lp)(a.rightVertex.pos,n,t),e,o,t,s),i===d?this._checkEdgeForParallelLines(r,f,e,o,t,s):i===u&&this._checkEdgeForParallelLines(r,l,e,o,t,s)}E=E.rightVertex.rightEdge}while(E&&E!==L);return s}_checkEdgeForParallelLines(e,t,s,i,r,n){const o=e.left,h=e.right;if((0,V.fg)(S,(0,p.Xz)(t),(0,p.Xz)(o),(0,p.Xz)(h)),(0,u.hG)(S,(0,p.Xz)(t))<f.N.parallelLineThreshold)return;(0,V.fg)(S,(0,p.Xz)(s),(0,p.Xz)(o),(0,p.Xz)(h),(0,p.Xz)(t));const{spatialReference:a,pointer:d}=r,l=(0,p.de)((0,p.fA)(S[0],S[1],s[2]));if((0,v.pM)(i,(0,x.j)(l,a,c.qt,this.view))<this.squaredProximityThreshold(d)){var g;if(this.isVertical(l,t,r)||this.isVertical(o,h,r))return;if(function(e,t){const s=e.left,i=e.right;for(const r of t)if((0,V.fg)(S,(0,p.Xz)(i),(0,p.Xz)(r.constraint.start),(0,p.Xz)(r.constraint.end),(0,p.Xz)(s)),(0,u.hG)(S,(0,p.Xz)(i))<f.N.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}(e,n))return;n.push(new T.B({referenceLine:e,lineStart:t,targetPoint:l,isDraped:"on-the-ground"===(null===(g=r.elevationInfo)||void 0===g?void 0:g.mode)}))}}}const S=(0,P.vt)();var q=s(20664),z=s(75543),X=s(78228);class M extends L{constructor(e,t,s){super(e,t),this._geodesicLengthMeasurementUtils=s}snapNewVertex(e,t){const s=t.editGeometryOperations.data.components[0],i=[];if(s.vertices.length<2)return i;const{view:r}=this,n=(0,x.j)(e,t.spatialReference,c.qt,r),o=s.vertices.at(-1);this._checkForSnappingCandidate(X._b.LastVertex,i,o.leftEdge,o,o.leftEdge.leftVertex,e,n,t);const h=s.vertices[0];return this._checkForSnappingCandidate(X._b.FirstVertex,i,h.rightEdge,h,h.rightEdge.rightVertex,e,n,t),i}snapExistingVertex(e,t){const s=[],i=t.vertexHandle;if(i.component.vertices.length<3)return s;const{view:r}=this,n=(0,x.j)(e,t.spatialReference,c.qt,r),o=i.leftEdge,h=i.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const i=o.leftVertex.leftEdge;this._checkForSnappingCandidate(X._b.ExistingEdge,s,i,i.rightVertex,i.leftVertex,e,n,t)}if(null!==h&&void 0!==h&&h.rightVertex.rightEdge){const i=h.rightVertex.rightEdge;this._checkForSnappingCandidate(X._b.ExistingEdge,s,i,i.leftVertex,i.rightVertex,e,n,t)}return s}_checkForSnappingCandidate(e,t,s,i,r,n,o,h){if(!this.edgeExceedsShortLineThreshold(s,h))return;const c=this.view,g=(0,p.Lp)(i.pos,c,h),f=(0,p.Lp)(r.pos,c,h);(function(e,t,s,i,r,n){(function(e,t,s,i,r,n){let{spatialReference:o}=r;const h=(0,_.IP)(t,s,o,o);if(null==h)return!1;const c=(0,_.IP)(s,i,o,o);if(null==c)return!1;const p=Math.sign(a.uC.shortestSignedDiff(h,c))*Math.PI*.5,g=(0,d.Wq)(h+p,"radians","geographic"),u=(0,l.vt)(),f=n.geodesicDistance(s,i,o);return null!=f&&((0,_.rT)(u,s,o,(0,d.l3)(f,"meters"),g,"geodesic"),(0,q.d)(e,u,s),!0)})(e,t,s,i,r,n)||function(e,t,s){const i=(0,u.Re)(C,(0,p.Xz)(s),(0,p.Xz)(t));(0,q.i)(e,i[1],-i[0],0)}(e,t,s)})(R,f,g,n,h,this._geodesicLengthMeasurementUtils),this._checkForSnappingCandidateAlongProjectedRay(e,t,f,g,R,n,o,h)}_checkForSnappingCandidateAlongProjectedRay(e,t,s,i,r,n,o,h){var a;const{spatialReference:d,pointer:g}=h,f=(0,u.Re)(C,(0,p.Xz)(n),(0,p.Xz)(i)),L=(0,u.Om)(r,f)/(0,u.m3)(r),E=(0,u.Ln)(C,(0,p.Xz)(i),r,L),_=(0,p.de)((0,p.fA)(E[0],E[1],n[2]));if((0,v.pM)(o,(0,x.j)(_,d,c.qt,this.view))>this.squaredProximityThreshold(g)||this.isVertical(_,i,h)||this.isVertical(i,s,h))return;const w=(0,q.b)((0,l.vt)(),i,r,Math.sign(L));t.push(new X.HJ({targetPoint:_,constraint:new z.FX(i,(0,p._7)(w)),previousVertex:s,otherVertex:i,otherVertexType:X.pn.CENTER,selfSnappingType:e,isDraped:"on-the-ground"===(null===(a=h.elevationInfo)||void 0===a?void 0:a.mode)}))}}const C=(0,P.vt)(),R=(0,l.vt)();var k=s(59380);class F extends L{snapNewVertex(e,t){const s=t.editGeometryOperations.data.components[0],i=[],r=s.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;const{view:n}=this,o=s.vertices[0],h=s.vertices[r-1],a=(0,p.Lp)(o.pos,n,t),d=(0,p.Lp)(h.pos,n,t);return this._processCandidateProposal(a,d,e,t,i),i}snapExistingVertex(e,t){const s=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return s;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===r.vertices.length-1))return s;const{view:n}=this,o=(0,p.Lp)(i.leftEdge.leftVertex.pos,n,t),h=(0,p.Lp)(i.rightEdge.rightVertex.pos,n,t);return this._processCandidateProposal(o,h,e,t,s),s}_processCandidateProposal(e,t,s,i,r){if(!this.exceedsShortLineThreshold(e,t,i))return;const n=(0,u.Cc)(j,(0,p.Xz)(e),(0,p.Xz)(t),.5),o=.5*(0,u.Io)((0,p.Xz)(e),(0,p.Xz)(t)),h=(0,V.Dh)(j,(0,p.Xz)(s),n,o),a=(0,p.de)((0,p.fA)(h[0],h[1],s[2])),{spatialReference:d,pointer:l}=i,g=(0,x.j)(s,d,c.qt,this.view);if((0,v.pM)(g,(0,x.j)(a,d,c.qt,this.view))<this.squaredProximityThreshold(l)){var f;if(this.isVertical(e,a,i)||this.isVertical(a,t,i))return;r.push(new k.R({targetPoint:a,point1:e,point2:t,isDraped:"on-the-ground"===(null===(f=i.elevationInfo)||void 0===f?void 0:f.mode)}))}}}const j=(0,P.vt)();var I=s(99791);let N=class extends r.A{constructor(e){super(e),this.updating=!1,this._snappers=new n.A,this._domain=I.n.SELF}initialize(){this._snappers.push(new y(this.view,this.options),new m(this.view,this.options,this.geodesicLengthMeasurementUtils),new M(this.view,this.options,this.geodesicLengthMeasurementUtils),new F(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,s){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const i=[];for(const r of this._snappers.items)for(const t of r.snap(e,s))i.push(t);return(0,v.xX)(e,i),i}};(0,i._)([(0,o.MZ)({readOnly:!0})],N.prototype,"updating",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],N.prototype,"view",void 0),(0,i._)([(0,o.MZ)({constructOnly:!0})],N.prototype,"geodesicLengthMeasurementUtils",void 0),(0,i._)([(0,o.MZ)()],N.prototype,"options",null),N=(0,i._)([(0,h.$)("esri.views.interactive.snapping.SelfSnappingEngine")],N)}}]);
//# sourceMappingURL=7960.7797654a.chunk.js.map